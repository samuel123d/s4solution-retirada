<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>S4Solution | Titulares</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background:#f4f6f9; font-family: Arial, sans-serif; }
    header { background:#111827; color:#fff; }
    header a { color:#fff; text-decoration:none; }
    header a:hover { color:#60a5fa; }
    .card { border:none; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.1); margin-bottom:20px; }
    input, button { width: 100%; margin-bottom:10px; }
    button { border-radius:6px; }
    .list-group-item { cursor:pointer; word-break: break-word; }
    @media (max-width:576px) {
      h2 { font-size:1.5rem; }
      small { font-size:0.9rem; }
    }
  </style>
</head>
<body>

<header class="py-2 mb-3">
  <div class="container my-3 d-flex flex-column flex-sm-row justify-content-between align-items-center">
    <h2 class="fw-bold mb-2 mb-sm-0">S4SOLUTION</h2>
    <small>Sistema de Controle de Encomendas</small>
    <nav class="mt-2 mt-sm-0 d-flex gap-3">
      <a href="index.html">In√≠cio</a>
      <a href="./encomendas.html">Encomendas</a>
      <a href="./titulares.html">Titulares</a>
    </nav>
  </div>
</header>

<main class="container">
  <div class="card p-4">
    <h2 class="mb-3 text-center">Cadastro de Titulares</h2>
    <form id="formTitular">
      <div class="mb-3">
        <input type="text" name="nome" class="form-control" placeholder="Nome do titular" required>
      </div>
      <div class="mb-3 row">
        <div class="col-6 mb-2 mb-sm-0">
          <input type="text" name="bloco" class="form-control" placeholder="Bloco" required>
        </div>
        <div class="col-6">
          <input type="number" name="casa" class="form-control" placeholder="Casa/Apt" required min="1">
        </div>
      </div>
      <div class="mb-3">
        <input type="text" id="telefone" name="telefone" class="form-control" placeholder="Telefone (somente n√∫meros) - EX: 8499981122" required>
      </div>
      <button type="submit" class="btn btn-primary">Salvar</button>
    </form>
  </div>

  <div class="card p-4">
    <h3 class="mb-3 text-center">Lista de Titulares</h3>
    <ul id="listaTitulares" class="list-group"></ul>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDQVdWTpDvXZqgawxnrxRWtG7HD02VxKDI",
  authDomain: "s4solution-7466a.firebaseapp.com",
  projectId: "s4solution-7466a",
  storageBucket: "s4solution-7466a.firebasestorage.app",
  messagingSenderId: "365611705854",
  appId: "1:365611705854:web:054b6de3849793b1294caf",
  measurementId: "G-HEP3WV471B"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lista = document.getElementById("listaTitulares");
const form = document.getElementById("formTitular");
const telefoneInput = document.getElementById("telefone");

/* Listar Titulares */
async function listarTitulares() {
  lista.innerHTML = "";
  const titularesSnap = await getDocs(collection(db, "titulares"));

  titularesSnap.forEach(docu => {
    const t = docu.data();
    const li = document.createElement("li");
    li.className = "list-group-item mb-3";
    li.innerHTML = `
      <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center">
        <div class="mb-2 mb-sm-0">
          <strong>${t.nome}</strong><br>
          Bloco ${t.bloco} ‚Ä¢ Casa ${t.casa}<br>
          üìû ${t.telefone}
        </div>
        <button class="btn btn-sm btn-danger mt-2 mt-sm-0" onclick="deletar('${docu.id}')">
          üóëÔ∏è Excluir Titular
        </button>
      </div>
    `;
    lista.appendChild(li);
  });
}

/* Cadastrar Titular */
form.addEventListener("submit", async e => {
  e.preventDefault();
  const telefone = telefoneInput.value.trim();
  if (!/^\d{10,11}$/.test(telefone)) {
    alert("Digite um n√∫mero de telefone v√°lido (somente n√∫meros, 10 ou 11 d√≠gitos).");
    return;
  }
  await addDoc(collection(db, "titulares"), {
    nome: form.nome.value,
    bloco: form.bloco.value,
    casa: form.casa.value,
    telefone: telefone
  });
  form.reset();
  listarTitulares();
});

/* Excluir Titular */
window.deletar = async id => {
  await deleteDoc(doc(db, "titulares", id));
  listarTitulares();
};

listarTitulares();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
